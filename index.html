<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>미디어+스크립트 빌더 (YouTube 기본 플레이어)</title>
  <style>
    :root{
      --bg:#0b1020; --text:#e9ecf5; --muted:#aab3d6; --border:rgba(255,255,255,.12);
      --shadow:0 12px 28px rgba(0,0,0,.35); --radius:16px;
      --sans: ui-sans-serif, system-ui, -apple-system, "Apple SD Gothic Neo", "Noto Sans KR", Segoe UI, Roboto, Helvetica, Arial;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:var(--sans); color:var(--text);
      background: radial-gradient(1200px 700px at 20% 0%, rgba(106,169,255,.18), transparent 55%),
                  radial-gradient(900px 600px at 90% 10%, rgba(255,106,214,.12), transparent 55%),
                  var(--bg);
    }
    .wrap{max-width:1200px;margin:0 auto;padding:20px}
    .topbar{
      display:flex;gap:12px;align-items:center;justify-content:space-between;
      padding:14px 16px;border:1px solid var(--border);border-radius:var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
    }
    .topbar h1{font-size:16px;margin:0}
    .pill{font-size:12px;color:var(--muted);border:1px solid var(--border);padding:6px 10px;border-radius:999px}
    .mono{font-family:var(--mono)}
    .grid{display:grid;grid-template-columns:1fr;gap:16px;margin-top:16px}
    @media (min-width:980px){ .grid{grid-template-columns:420px 1fr;} }
    .card{
      border:1px solid var(--border);border-radius:var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      box-shadow: var(--shadow); overflow:hidden;
    }
    .hd{padding:12px 14px;border-bottom:1px solid var(--border);background:rgba(0,0,0,.18);
        display:flex;justify-content:space-between;align-items:center;gap:10px}
    .hd .title{font-weight:800;font-size:13px}
    .bd{padding:14px}
    label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}
    input[type="text"], textarea{
      width:100%; background:rgba(0,0,0,.25); border:1px solid var(--border);
      border-radius:12px; padding:10px 12px; color:var(--text); outline:none;
    }
    textarea{min-height:220px;resize:vertical;line-height:1.5}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    button{
      border:1px solid var(--border); background:rgba(255,255,255,.06); color:var(--text);
      padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:800;
    }
    button.primary{background:rgba(106,169,255,.14)}
    .hint{font-size:12px;color:var(--muted);line-height:1.5;margin-top:10px}
    .badge{font-size:12px;color:var(--muted);border:1px solid var(--border);padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.04)}
    .error{margin-top:10px;font-size:12px;color:#ffb3c1}

    /* 레이아웃 */
    .lesson{display:grid;grid-template-columns:1fr;gap:12px;padding:14px}
    @media (min-width:980px){ .lesson{grid-template-columns:1fr 2fr;} }

    /* 오른쪽 스크롤 고정 */
    .pane{
      border:1px solid var(--border);border-radius:14px;overflow:hidden;background:rgba(0,0,0,.18);
      display:flex;flex-direction:column;
      height: 70vh;
      min-height: 520px;
      max-height: 820px;
    }
    @media (max-width: 979px){
      .pane{ height: 60vh; min-height: 420px; }
    }
    .pane-hd{
      padding:10px 12px;border-bottom:1px solid var(--border);background:rgba(0,0,0,.18);
      display:flex;justify-content:space-between;align-items:center;gap:10px;flex:0 0 auto;
    }
    .pane-hd .small{font-size:12px;color:var(--muted)}
    .pane-bd{padding:12px;flex:1 1 auto;min-height:0}
    .pane-bd.scrollable{overflow:auto}
    .content{white-space:pre-wrap;line-height:1.65;font-size:14px}

    .iframe-wrap{position:relative;width:100%;aspect-ratio:16/9;border:1px solid var(--border);border-radius:12px;overflow:hidden;background:#000}
    .iframe-wrap iframe{position:absolute;inset:0;width:100%;height:100%;border:0}

    audio{width:100%}
  </style>
</head>
<body>
<div class="wrap">
  <div class="topbar">
    <div style="display:flex;align-items:center;gap:10px">
      <h1>미디어(왼쪽 1/3) + 스크립트(오른쪽 2/3)</h1>
      <span class="pill">YouTube: 기본 플레이어로 재생</span>
    </div>
    <span class="pill mono" id="statusPill">READY</span>
  </div>

  <div class="grid">
    <!-- Builder -->
    <div class="card">
      <div class="hd"><div class="title">제작(입력 → 미리보기/내보내기)</div><span class="pill">Builder</span></div>
      <div class="bd">
        <label>미디어 링크 (YouTube/Vimeo 또는 오디오 URL)</label>
        <input id="mediaUrl" type="text" placeholder="https://www.youtube.com/watch?v=... / https://vimeo.com/... / https://.../audio.mp3" />

        <label>오른쪽 설명자료(스크립트/문제)</label>
        <textarea id="docText" placeholder="긴 텍스트를 넣으면 오른쪽에 스크롤바가 생깁니다."></textarea>

        <div class="row">
          <button class="primary" id="applyBtn">미리보기 적용</button>
          <button id="exportBtn">lesson.html 다운로드</button>
          <button id="resetBtn">초기화</button>
        </div>

        <div class="hint">
          YouTube는 커스텀 재생 버튼 없이, 영상 안의 기본 ▶ 버튼으로 재생합니다(GitHub Pages에서 가장 안정적).
        </div>
        <div class="error" id="errorBox" style="display:none"></div>
      </div>
    </div>

    <!-- Preview -->
    <div class="card">
      <div class="hd">
        <div class="title">미리보기</div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <span class="badge" id="mediaTypeBadge">Media: -</span>
          <span class="badge" id="sourceBadge">Source: -</span>
        </div>
      </div>

      <div class="lesson">
        <!-- Left -->
        <div class="pane">
          <div class="pane-hd">
            <div style="display:flex;gap:10px;align-items:center">
              <strong style="font-size:13px">미디어</strong>
              <span class="small">왼쪽 1/3</span>
            </div>
            <span class="pill mono" id="leftMeta">-</span>
          </div>
          <div class="pane-bd" id="mediaHost">
            <div class="hint">미디어 링크를 넣고 “미리보기 적용”을 누르세요.</div>
          </div>
        </div>

        <!-- Right -->
        <div class="pane">
          <div class="pane-hd">
            <div style="display:flex;gap:10px;align-items:center">
              <strong style="font-size:13px">스크립트/설명/문제</strong>
              <span class="small">오른쪽 2/3 (스크롤)</span>
            </div>
            <span class="pill mono" id="rightMeta">-</span>
          </div>
          <div class="pane-bd scrollable">
            <div class="content" id="docHost">오른쪽에 텍스트가 표시됩니다.</div>
          </div>
        </div>
      </div>

      <div style="padding:0 14px 14px">
        <div class="hint">YouTube 재생은 iframe 기본 UI로 처리합니다.</div>
      </div>
    </div>
  </div>
</div>

<script>
  // ===== Helpers =====
  function isAudioUrl(url){
    try{ const u=new URL(url); return /\.(mp3|m4a|ogg|wav|webm)$/i.test(u.pathname); }catch(e){ return false; }
  }
  function parseYouTubeId(url){
    try{
      const u = new URL(url);
      if (u.hostname.includes("youtu.be")) return u.pathname.replace("/", "") || null;
      if (u.hostname.includes("youtube.com")){
        const v = u.searchParams.get("v"); if (v) return v;
        const m = u.pathname.match(/\\/shorts\\/([^\\/]+)/); if (m) return m[1];
        const e = u.pathname.match(/\\/embed\\/([^\\/]+)/); if (e) return e[1];
      }
      return null;
    }catch(e){ return null; }
  }
  function parseVimeoId(url){
    try{
      const u = new URL(url);
      if (!u.hostname.includes("vimeo.com")) return null;
      const m = u.pathname.match(/\\/(\\d+)/);
      return m ? m[1] : null;
    }catch(e){ return null; }
  }
  function escapeHtml(str){
    return (str ?? "").replace(/[&<>"']/g, s => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[s]));
  }
  function escapeHtmlAttr(str){ return escapeHtml(str).replace(/`/g,"&#96;"); }

  // ===== DOM =====
  const mediaUrl = document.getElementById("mediaUrl");
  const docText = document.getElementById("docText");
  const applyBtn = document.getElementById("applyBtn");
  const exportBtn = document.getElementById("exportBtn");
  const resetBtn = document.getElementById("resetBtn");

  const mediaHost = document.getElementById("mediaHost");
  const docHost = document.getElementById("docHost");
  const mediaTypeBadge = document.getElementById("mediaTypeBadge");
  const sourceBadge = document.getElementById("sourceBadge");
  const leftMeta = document.getElementById("leftMeta");
  const rightMeta = document.getElementById("rightMeta");
  const statusPill = document.getElementById("statusPill");
  const errorBox = document.getElementById("errorBox");

  function setError(msg){
    if(!msg){ errorBox.style.display="none"; errorBox.textContent=""; return; }
    errorBox.style.display="block"; errorBox.textContent=msg;
  }

  function buildMediaHtml(url){
    const ytId = parseYouTubeId(url);
    if (ytId){
      return {
        type: "YouTube",
        html: `
          <div class="iframe-wrap">
            <iframe
              src="https://www.youtube.com/embed/${encodeURIComponent(ytId)}?rel=0&modestbranding=1"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen
              title="YouTube Video"></iframe>
          </div>
          <div class="hint" style="margin-top:10px">재생은 영상 안의 기본 ▶ 버튼을 누르세요.</div>
        `
      };
    }

    const vmId = parseVimeoId(url);
    if (vmId){
      return {
        type: "Vimeo",
        html: `
          <div class="iframe-wrap">
            <iframe
              src="https://player.vimeo.com/video/${encodeURIComponent(vmId)}"
              allow="autoplay; fullscreen; picture-in-picture"
              allowfullscreen
              title="Vimeo Video"></iframe>
          </div>
        `
      };
    }

    if (isAudioUrl(url)){
      return {
        type: "Audio",
        html: `
          <audio controls preload="metadata" src="${escapeHtmlAttr(url)}"></audio>
          <div class="hint" style="margin-top:10px">오디오 URL은 서버 정책(CORS/권한)에 따라 재생이 제한될 수 있습니다.</div>
        `
      };
    }

    return {
      type: "Link",
      html: `
        <div class="hint">YouTube/Vimeo/Audio로 인식되지 않아 iframe으로 표시합니다.</div>
        <div class="iframe-wrap" style="margin-top:10px">
          <iframe src="${escapeHtmlAttr(url)}" title="Embedded Content"></iframe>
        </div>
      `
    };
  }

  async function applyPreview(){
    setError(null);
    const url = (mediaUrl.value||"").trim();
    const text = (docText.value||"").trim();

    if(!url && !text){
      setError("미디어 링크 또는 설명자료 중 최소 1개는 입력해 주세요.");
      statusPill.textContent = "NEED INPUT";
      return;
    }

    // Right
    docHost.textContent = text || "오른쪽 텍스트가 비어 있습니다.";
    rightMeta.textContent = text ? (text.length + " chars") : "-";

    // Left
    if(!url){
      mediaHost.innerHTML = `<div class="hint">미디어 링크가 비어 있습니다.</div>`;
      mediaTypeBadge.textContent = "Media: -";
      sourceBadge.textContent = "Source: -";
      leftMeta.textContent = "-";
      statusPill.textContent = "APPLIED";
      return;
    }

    const m = buildMediaHtml(url);
    mediaHost.innerHTML = m.html;
    mediaTypeBadge.textContent = "Media: " + m.type;
    sourceBadge.textContent = "Source: " + url;
    leftMeta.textContent = m.type;
    statusPill.textContent = "APPLIED";
  }

  function buildLessonHtml(url, text){
    const safeText = escapeHtml(text || "");
    const m = url ? buildMediaHtml(url) : {type:"-", html:`<div class="hint">미디어 링크가 비어 있습니다.</div>`};

    return `<!doctype html>
<html lang="ko"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lesson</title>
<style>
  :root{--bg:#0b1020;--text:#e9ecf5;--muted:#aab3d6;--border:rgba(255,255,255,.12);--shadow:0 12px 28px rgba(0,0,0,.35);--radius:16px;
        --sans: ui-sans-serif, system-ui, -apple-system, "Apple SD Gothic Neo", "Noto Sans KR", Segoe UI, Roboto, Helvetica, Arial;}
  *{box-sizing:border-box}
  body{margin:0;font-family:var(--sans);color:var(--text);background:var(--bg);padding:18px}
  .frame{max-width:1200px;margin:0 auto;border:1px solid var(--border);border-radius:var(--radius);
         background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));box-shadow:var(--shadow);overflow:hidden}
  .hd{padding:12px 14px;border-bottom:1px solid var(--border);background:rgba(0,0,0,.18);display:flex;justify-content:space-between;gap:10px;align-items:center}
  .hd .title{font-weight:800;font-size:14px}
  .hd .meta{font-size:12px;color:var(--muted)}
  .lesson{display:grid;grid-template-columns:1fr;gap:12px;padding:14px}
  @media (min-width:980px){.lesson{grid-template-columns:1fr 2fr}}
  .pane{border:1px solid var(--border);border-radius:14px;overflow:hidden;background:rgba(0,0,0,.18);display:flex;flex-direction:column;height:70vh;min-height:520px;max-height:820px}
  @media (max-width:979px){.pane{height:60vh;min-height:420px}}
  .pane-hd{padding:10px 12px;border-bottom:1px solid var(--border);background:rgba(0,0,0,.18);display:flex;justify-content:space-between;gap:10px;align-items:center}
  .pane-hd .small{font-size:12px;color:var(--muted)}
  .pane-bd{padding:12px;flex:1 1 auto;min-height:0}
  .pane-bd.scrollable{overflow:auto}
  .content{white-space:pre-wrap;line-height:1.65;font-size:14px}
  .hint{font-size:12px;color:var(--muted);line-height:1.5}
  .iframe-wrap{position:relative;width:100%;aspect-ratio:16/9;border:1px solid var(--border);border-radius:12px;overflow:hidden;background:#000}
  .iframe-wrap iframe{position:absolute;inset:0;width:100%;height:100%;border:0}
  audio{width:100%}
</style>
</head><body>
<div class="frame">
  <div class="hd">
    <div class="title">미디어 + 스크립트</div>
    <div class="meta">Source: ${escapeHtml(url||"-")}</div>
  </div>
  <div class="lesson">
    <div class="pane">
      <div class="pane-hd"><div><strong>미디어</strong> <span class="small">왼쪽 1/3</span></div><span class="small">${m.type}</span></div>
      <div class="pane-bd">${m.html}</div>
    </div>
    <div class="pane">
      <div class="pane-hd"><div><strong>스크립트/설명/문제</strong> <span class="small">오른쪽 2/3 (스크롤)</span></div><span class="small">${safeText.length} chars</span></div>
      <div class="pane-bd scrollable"><div class="content">${safeText || "텍스트가 비어 있습니다."}</div></div>
    </div>
  </div>
</div>
</body></html>`;
  }

  applyBtn.addEventListener("click", applyPreview);

  exportBtn.addEventListener("click", ()=>{
    setError(null);
    const url = (mediaUrl.value||"").trim();
    const text = (docText.value||"").trim();
    if(!url && !text){
      setError("내보내기: 미디어 링크 또는 설명자료 중 최소 1개는 입력해 주세요.");
      statusPill.textContent="NEED INPUT";
      return;
    }
    const html = buildLessonHtml(url, text);
    const blob = new Blob([html], {type:"text/html;charset=utf-8"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "lesson.html";
    document.body.appendChild(a);
    a.click();
    a.remove();
    statusPill.textContent="EXPORTED";
  });

  resetBtn.addEventListener("click", ()=>{
    setError(null);
    mediaUrl.value=""; docText.value="";
    mediaHost.innerHTML = `<div class="hint">미디어 링크를 넣고 “미리보기 적용”을 누르세요.</div>`;
    docHost.textContent = "오른쪽에 텍스트가 표시됩니다.";
    mediaTypeBadge.textContent="Media: -";
    sourceBadge.textContent="Source: -";
    leftMeta.textContent="-";
    rightMeta.textContent="-";
    statusPill.textContent="READY";
  });

  // 기본 예시
  mediaUrl.value = "https://www.youtube.com/watch?v=dQw4w9WgXcQ";
  docText.value = ("[긴 텍스트 스크롤 테스트]\\n\\n" + "내용\\n".repeat(250));
  applyPreview();
</script>
</body>
</html>
